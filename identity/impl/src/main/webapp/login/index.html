<!doctype html>
<html>
<head>

<link href="../lib/bootstrap/css/bootstrap.css" rel="stylesheet">

<script src="../lib/angular/angular.js"></script>
<script src="../lib/angular/angular-bootstrap.js"></script>
<script src="../lib/angular/angular-resource.js"></script>

<script>
    var login = angular.module('login', [ 'ngResource' ]);

    function LoginCtrl($scope, $resource) {
        var query = location.search.substring(1).split("&");
        for (var i = 0; i < query.length; i++) {
            var p = query[i].split("=");
            if (p[0] == "key") {
                $scope.appKey = p[1];   
            } else if (p[0] == "error") {
                $scope.error = p[1];
            }
        }

        var configRes = $resource('/ejs-identity/api/login/' + $scope.appKey);
        $scope.config = configRes.get();
    }
</script>
</head>
<body ng-app="login" ng-controller="LoginCtrl" style="background-color: #333;">
    <div class="modal">
        <div class="modal-body">
            <fieldset>
                <legend>Login</legend>
                <div>
                    <div class="alert alert-error" ng-show="error">Invalid username or password</div>
                    
                    <div style="width: 60%; float: left;">
                        <form action="/ejs-identity/api/login/{{appKey}}" method="post">
                            <label for="username">Username</label>
                            <input type="text" name="username" placeholder="Username" required />

                            <label for="password">Password</label>
                            <input type="password" name="password" placeholder="Password" required />

                            <div style="margin-top: 1em;">
                                <button type="submit" class="btn">Login</button>
                            </div>
                        </form>
                    </div>
                    <div style="width: 40%; float: left;">
                        <div ng-repeat="provider in config.providerConfigs"
                            style="float: left; margin-right: 1em; margin-top: 1em;">
                            <a ng-href="{{provider.loginUri}}"><img ng-src="{{provider.icon}}" /></a>
                        </div>
                    </div>
            </fieldset>
        </div>
    </div>
    </div>
</body>
</html>